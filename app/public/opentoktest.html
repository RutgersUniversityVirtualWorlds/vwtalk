<!DOCTYPE html>
<html>
  <head>
    <title>OpenTok -- Bootstrap Hello</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet" media="screen">

   <script src="https://www.tokbox.com/webrtc/v2.0/js/TB.js" ></script>
        <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="//code.jquery.com/jquery.js"></script>
  </head>
  <body>
    <h1>Hello OpenTok WebRTC  -- Boot</h1>

        <div id="myPublisherDiv"></div>

        <script type="text/javascript">
           TB.setLogLevel(TB.DEBUG);
          // Initialize API key, session, and token...
          // Think of a session as a room, and a token as the key to get in to the room
          // Sessions and tokens are generated on your server and passed down to the client
        //  var apiKey = "10120602";
         // var sessionId = "1_MX4xMDEyMDYwMn4xMjcuMC4wLjF-VHVlIE9jdCAwMSAwNzo1MDowMSBQRFQgMjAxM34wLjAzNjEyMDU5NH4";
         // var token = "T1==cGFydG5lcl9pZD0xMDEyMDYwMiZzZGtfdmVyc2lvbj10YnJ1YnktdGJyYi12MC45MS4yMDExLTAyLTE3JnNpZz1hYmEwMmUxYWYyMTIwYTk5YmVjZjU3YjIzMDgyYTVkN2Y3ZDI4YzdhOnJvbGU9cHVibGlzaGVyJnNlc3Npb25faWQ9MV9NWDR4TURFeU1EWXdNbjR4TWpjdU1DNHdMakYtVkhWbElFOWpkQ0F3TVNBd056bzFNRG93TVNCUVJGUWdNakF4TTM0d0xqQXpOakV5TURVNU5INCZjcmVhdGVfdGltZT0xMzgwNjM5MDAxJm5vbmNlPTAuMjI3MjQzODAxMjgxNzEyNjImZXhwaXJlX3RpbWU9MTM4MDcyNTM5OCZjb25uZWN0aW9uX2RhdGE9";
          var session;
          var user = "rianders";
          var room = "room1";
          var gData;
                 
             $.ajax({
               
                dataType: "json",
                url: "/api/" + user + "/" + room,
                success: function(data) {
                       // Initialize session, set up event listeners, and connect
                     session = TB.initSession(data.sessionID);
                     session.addEventListener('sessionConnected', sessionConnectedHandler);
                     console.log("Before:");
                     console.log(data.sessionID);
                     session.connect(data.apikey, data.token);
                     console.log("After:");
                     console.log(data);
                 //    console.log("ajax call complete");
                }
            });

          function sessionConnectedHandler(event) {
            var publisher = TB.initPublisher(event.apiKey, 'myPublisherDiv');
            session.publish(publisher);
          }
        </script>

    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
  </body>
</html>